(()=>{"use strict";var e,t,n={baseUrl:"https://nomoreparties.co/v1/".concat("cohort-mag-4"),headers:{authorization:"4f7c2bf6-ee8f-47df-b8ab-dfa6cf75782d","Content-Type":"application/json"}},o=document.querySelector("#card-template").content;function r(e){var t,o=e.target.closest(".places__item");(t=o.getAttribute("data-card-id"),fetch("".concat(n.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e)})),o.remove()}function c(e){var t=e.querySelector(".card__like_button"),n=e.querySelector(".card__like_counter"),o=e.getAttribute("data-card-id");!function(e){var t=e.getAttribute("data-card-id");return d[t].likes.some((function(e){return e._id===h._id}))}(e)?t.classList.remove("card__like_button_is-active"):t.classList.add("card__like_button_is-active"),n.textContent=d[o].likes.length}function a(e){var t,o=e.target.closest(".card"),r=o.getAttribute("data-card-id"),a=(o.querySelector(".card__like_counter"),d[r].likes.some((function(e){return e._id===h._id})));console.log(d[r]),console.log(a),(a?function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(r).then((function(e){d[r]=e})):(t=r,fetch("".concat(n.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){d[r]=e}))).then((function(){c(o)}))}function i(t){"Escape"===t.key&&u(e)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function s(t){(e=t).classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function l(e){var n=e.querySelector(t.submitButtonSelector);Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(e){var t,n;n=(t=e).nextElementSibling,t.validity.patternMismatch?n.textContent=t.getAttribute("data-pattern-messaage"):n.textContent=t.validationMessage})),function(e){return Array.from(e.querySelectorAll(".popup__input")).every((function(e){return e.validity.valid}))}(e)?n.removeAttribute("disabled"):n.setAttribute("disabled",null)}var d,p=document.querySelector(".popup_type_image"),f=p.querySelector(".popup__image"),m=p.querySelector(".popup__caption");function _(e,t){f.setAttribute("src",e),f.setAttribute("alt",t),m.textContent=t,s(p)}var h,v=document.querySelector(".places__list");function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,i=o.querySelector(".places__item").cloneNode(!0),u=i.querySelector(".card__image");i.setAttribute("data-card-id",e._id),u.setAttribute("src",e.link),u.setAttribute("alt",e.name),u.addEventListener("click",(function(){return t(e.link,e.name)})),i.querySelector(".card__title").textContent=e.name;var s=i.querySelector(".card__delete-button");return s.addEventListener("click",r),e.owner._id!==h._id&&s.remove(),i.querySelector(".card__like_button").addEventListener("click",n),c(i),i}(e,_);v[t](n)}var y=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),g=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__image"),E=document.forms["edit-profile"],q=E.elements.name,L=E.elements.description;E.addEventListener("submit",(function(e){var t,o;e.preventDefault(),B(e.target),(t=q.value,o=L.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){h=e,D()})).then(u(A)).finally(N(e.target)).catch((function(e){console.log(e)}))}));var A=document.querySelector(".popup_type_edit");g.addEventListener("click",(function(){q.value=y.textContent,L.value=S.textContent,l(E),s(A)}));var j=document.querySelector(".profile__add-button"),C=document.forms["new-place"],x=C["place-name"],P=C.link,U=document.querySelector(".popup_type_new-card");j.addEventListener("click",(function(){l(C),s(U)})),C.addEventListener("submit",(function(e){e.preventDefault(),B(e.target);var t,o,r={name:x.value,link:P.value};e.target.reset(),(t=r.name,o=r.link,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){d[e._id]=e,u(U),b(e)})).finally(N(e.target)).catch((function(e){console.log(e)}))}));var w=document.querySelector(".popup_type_avatar"),T=document.querySelector(".profile__image"),O=document.forms["edit-avatar"];function D(){y.textContent=h.name,S.textContent=h.about,k.setAttribute("style","background-image: url('".concat(h.avatar,"')"))}function B(e){e.querySelector(".popup__button").textContent="Сохранение..."}function N(e){e.querySelector(".popup__button").textContent="Сохранить"}T.addEventListener("click",(function(){s(w)})),O.addEventListener("submit",(function(e){var t;e.preventDefault(),B(e.target),(t=e.target.elements.link.value,fetch("".concat(n.baseUrl,"/users/me/avatar/"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){h=e,D()})).then(u(w)).finally(N(e.target)).catch((function(e){console.log(e)}))})),window.addEventListener("load",(function(){A.classList.add("popup_is-animated"),U.classList.add("popup_is-animated"),p.classList.add("popup_is-animated")})),function(){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{formSelector,inputSelector,submitButtonSelector,inputErrorSelector};t=Object.assign(e),Array.from(document.querySelectorAll(t.inputSelector)).forEach((function(e){e.addEventListener("input",(function(e){l(e.target.closest(t.formSelector))}))}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorSelector:".popup__input_error"}),[p,U,A,w].forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&u(e),t.target.classList.contains("popup__close")&&u(e)}))}));var e=fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){d={},e.forEach((function(e){d[e._id]=Object.assign(e)}))})).catch((function(e){console.log(e)})),o=fetch("".concat(n.baseUrl,"/users/me "),{headers:n.headers}).then((function(e){return e.json()})).then((function(e){h=e,D()})).catch(console.log);Promise.all([e,o]).then((function(){return function(e){v.innerHTML="",e.forEach((function(e){return b(e,"append")}))}(Object.values(d))})).catch(console.log)}()})();