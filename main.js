(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/".concat("cohort-mag-4"),headers:{authorization:"4f7c2bf6-ee8f-47df-b8ab-dfa6cf75782d","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var n=document.querySelector("#card-template").content;function o(n,o){var r,c=n.target.closest(".card").querySelector(".card__like_counter");n.target.classList.contains("card__like_button_is-active")?function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}(o).then((function(){n.target.classList.remove("card__like_button_is-active"),c.textContent=c.textContent-1})).catch(console.log):(r=o,fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:e.headers}).then(t)).then((function(){n.target.classList.add("card__like_button_is-active"),c.textContent=+c.textContent+1})).catch(console.log)}function r(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&c(t)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function i(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0}function u(e,t){e.closest(".popup__input_container").querySelector(t.inputErrorSelector).textContent="",e.classList.remove(t.inputInvalidClass)}function l(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(e){u(e,t)})),i(n,o)}var s,d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorSelector:".popup__input_error",inputContainerSelector:".popup__input_container",inputInvalidClass:"popup__input-invalid"},p=document.querySelector(".popup_type_image"),_=p.querySelector(".popup__image"),f=p.querySelector(".popup__caption");function m(e,t){_.setAttribute("src",e),_.setAttribute("alt",t),f.textContent=t,a(p)}var v,h=document.querySelector(".places__list");function y(r){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",a=function(r,c,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o,u=n.querySelector(".places__item").cloneNode(!0),l=u.querySelector(".card__image");l.setAttribute("src",r.link),l.setAttribute("alt",r.name),l.addEventListener("click",(function(){return c(r.link,r.name)})),u.querySelector(".card__title").textContent=r.name;var s=u.querySelector(".card__delete-button");s.addEventListener("click",(function(n){return function(n,o){var r,c=n.target.closest(".places__item");(r=o,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then(t)).then((function(){c.remove()})).catch(console.log)}(n,r._id)})),r.owner._id!==a&&s.remove();var d=u.querySelector(".card__like_button");return d.addEventListener("click",(function(e){return i(e,r._id)})),r.likes.some((function(e){return a===e._id}))&&d.classList.add("card__like_button_is-active"),u.querySelector(".card__like_counter").textContent=r.likes.length,u}(r,m,v._id);h[c](a)}var S=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),g=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__image"),k=document.forms["edit-profile"],E=k.elements.name,L=k.elements.description;k.addEventListener("submit",(function(n){var o,r;n.preventDefault(),B(n.target),(o=E.value,r=L.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then(t)).then((function(e){v=e,N(),c(C)})).catch((function(e){console.log(e)})).finally((function(){H(n.target)}))}));var C=document.querySelector(".popup_type_edit");g.addEventListener("click",(function(){E.value=S.textContent,L.value=b.textContent,l(k,d),a(C)}));var x=document.querySelector(".profile__add-button"),A=document.forms["new-place"],U=A["place-name"],T=A.link,w=document.querySelector(".popup_type_new-card");x.addEventListener("click",(function(){l(A,d),a(w)})),A.addEventListener("submit",(function(n){n.preventDefault();var o,r,a={name:U.value,link:T.value};B(n.target),(o=a.name,r=a.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o,link:r})}).then(t)).then((function(e){n.target.reset(),c(w),y(e)})).catch((function(e){console.log(e)})).finally((function(){H(n.target)}))}));var P,D=document.querySelector(".popup_type_avatar"),O=document.querySelector(".profile__image"),j=document.forms["edit-avatar"];function N(){S.textContent=v.name,b.textContent=v.about,q.setAttribute("style","background-image: url('".concat(v.avatar,"')"))}function B(e){e.querySelector(".popup__button").textContent="Сохранение..."}function H(e){e.querySelector(".popup__button").textContent="Сохранить"}O.addEventListener("click",(function(){l(j,d),a(D)})),j.addEventListener("submit",(function(n){var o;n.preventDefault(),B(n.target),(o=n.target.elements.link.value,fetch("".concat(e.baseUrl,"/users/me/avatar/"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t)).then((function(e){v=e,N(),j.reset(),c(D)})).catch((function(e){console.log(e)})).finally((function(){H(n.target)}))})),P=d,Array.from(document.querySelectorAll(P.formSelector)).forEach((function(e){return function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){e.closest(".popup__input_container").querySelector(t.inputErrorSelector),e.validity.valid?u(e,t):function(e,t){var n=e.closest(".popup__input_container").querySelector(t.inputErrorSelector);e.validity.patternMismatch?n.textContent=e.getAttribute("data-pattern-messaage"):n.textContent=e.validationMessage,e.classList.add(t.inputInvalidClass)}(e,t)}(e,t),i(n,o)}))})),i(n,o)}(e,P)})),[p,w,C,D].forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&c(e),t.target.classList.contains("popup__close")&&c(e)}))})),Promise.all([fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).then((function(e){s=e})),fetch("".concat(e.baseUrl,"/users/me "),{headers:e.headers}).then(t).then((function(e){v=e,N()}))]).then((function(){!function(e){h.innerHTML="",e.forEach((function(e){return y(e,"append")}))}(Object.values(s)),N()})).catch(console.log)})();