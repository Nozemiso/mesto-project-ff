(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/".concat("cohort-mag-4"),headers:{authorization:"4f7c2bf6-ee8f-47df-b8ab-dfa6cf75782d","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var n=document.querySelector("#card-template").content;function r(n,r){var o,c=n.target.closest(".card").querySelector(".card__like_counter");n.target.classList.contains("card__like_button_is-active")?function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}(r).then((function(){n.target.classList.remove("card__like_button_is-active"),c.textContent=c.textContent-1})).catch(console.log):(o=r,fetch("".concat(e.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:e.headers}).then(t)).then((function(){n.target.classList.add("card__like_button_is-active"),c.textContent=+c.textContent+1})).catch(console.log)}function o(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&c(t)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function i(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0}function u(e,t){var n=Array.from(e.querySelectorAll(t.inputErrorSelector)),r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.textContent=""})),i(r,o)}var l,s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorSelector:".popup__input_error",inputContainerSelector:".popup__input_container"},d=document.querySelector(".popup_type_image"),p=d.querySelector(".popup__image"),_=d.querySelector(".popup__caption");function f(e,t){p.setAttribute("src",e),p.setAttribute("alt",t),_.textContent=t,a(d)}var m,h=document.querySelector(".places__list");function v(o){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",a=function(o,c,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,u=n.querySelector(".places__item").cloneNode(!0),l=u.querySelector(".card__image");l.setAttribute("src",o.link),l.setAttribute("alt",o.name),l.addEventListener("click",(function(){return c(o.link,o.name)})),u.querySelector(".card__title").textContent=o.name;var s=u.querySelector(".card__delete-button");s.addEventListener("click",(function(n){return function(n,r){var o,c=n.target.closest(".places__item");(o=r,fetch("".concat(e.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:e.headers}).then(t)).catch(console.log).then(c.remove())}(n,o._id)})),o.owner._id!==a&&s.remove();var d=u.querySelector(".card__like_button");return d.addEventListener("click",(function(e){return i(e,o._id)})),o.likes.some((function(e){return a===e._id}))&&d.classList.add("card__like_button_is-active"),u.querySelector(".card__like_counter").textContent=o.likes.length,u}(o,f,m._id);h[c](a)}var y=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),b=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__image"),q=document.forms["edit-profile"],k=q.elements.name,E=q.elements.description;q.addEventListener("submit",(function(n){var r,o;n.preventDefault(),N(n.target),(r=k.value,o=E.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:o})}).then(t)).then((function(e){m=e,j(),c(L),B(n.target)})).catch((function(e){console.log(e),B(n.target)}))}));var L=document.querySelector(".popup_type_edit");b.addEventListener("click",(function(){k.value=y.textContent,E.value=S.textContent,u(q,s),a(L)}));var C=document.querySelector(".profile__add-button"),x=document.forms["new-place"],A=x["place-name"],U=x.link,T=document.querySelector(".popup_type_new-card");C.addEventListener("click",(function(){u(x,s),a(T)})),x.addEventListener("submit",(function(n){n.preventDefault();var r,o,a={name:A.value,link:U.value};N(n.target),(r=a.name,o=a.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:o})}).then(t)).then((function(e){n.target.reset(),c(T),v(e),B(n.target)})).catch((function(e){console.log(e),B(n.target)}))}));var w,P=document.querySelector(".popup_type_avatar"),D=document.querySelector(".profile__image"),O=document.forms["edit-avatar"];function j(){y.textContent=m.name,S.textContent=m.about,g.setAttribute("style","background-image: url('".concat(m.avatar,"')"))}function N(e){e.querySelector(".popup__button").textContent="Сохранение..."}function B(e){e.querySelector(".popup__button").textContent="Сохранить"}D.addEventListener("click",(function(){u(O,s),a(P)})),O.addEventListener("submit",(function(n){var r;n.preventDefault(),N(n.target),(r=n.target.elements.link.value,fetch("".concat(e.baseUrl,"/users/me/avatar/"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then(t)).then((function(e){m=e,j(),O.reset(),c(P),B(n.target)})).catch((function(e){console.log(e),B(n.target)}))})),w=s,Array.from(document.querySelectorAll(w.formSelector)).forEach((function(e){return function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){var n=e.closest(".popup__input_container").querySelector(t.inputErrorSelector);e.validity.patternMismatch?n.textContent=e.getAttribute("data-pattern-messaage"):n.textContent=e.validationMessage}(e,t),i(n,r)}))})),i(n,r)}(e,w)})),[d,T,L,P].forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&c(e),t.target.classList.contains("popup__close")&&c(e)}))})),Promise.all([fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).then((function(e){l=e})),fetch("".concat(e.baseUrl,"/users/me "),{headers:e.headers}).then(t).then((function(e){m=e,j()}))]).then((function(){!function(e){h.innerHTML="",e.forEach((function(e){return v(e,"append")}))}(Object.values(l)),j()})).catch(console.log)})();