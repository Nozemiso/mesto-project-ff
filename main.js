(()=>{"use strict";var e,t,n={baseUrl:"https://nomoreparties.co/v1/".concat("cohort-mag-4"),headers:{authorization:"4f7c2bf6-ee8f-47df-b8ab-dfa6cf75782d","Content-Type":"application/json"}},o=document.querySelector("#card-template").content;function r(e){var t,o=e.target.closest(".places__item");(t=o.getAttribute("data-card-id"),fetch("".concat(n.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e)})),o.remove()}function c(e){var t=e.querySelector(".card__like_button"),n=e.querySelector(".card__like_counter"),o=e.getAttribute("data-card-id");!function(e){var t=e.getAttribute("data-card-id");return p[t].likes.some((function(e){return e._id===v._id}))}(e)?t.classList.remove("card__like_button_is-active"):t.classList.add("card__like_button_is-active"),n.textContent=p[o].likes.length}function a(e){var t,o=e.target.closest(".card"),r=o.getAttribute("data-card-id"),a=(o.querySelector(".card__like_counter"),p[r].likes.some((function(e){return e._id===v._id})));console.log(p[r]),console.log(a),(a?function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(r).then((function(e){p[r]=e})):(t=r,fetch("".concat(n.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){p[r]=e}))).then((function(){c(o)}))}function i(t){"Escape"===t.key&&u(e)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function l(t){(e=t).classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function d(e){var n=e.querySelector(t.submitButtonSelector);Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(e){var t,n;n=(t=e).nextElementSibling,t.validity.patternMismatch?n.textContent=t.getAttribute("data-pattern-messaage"):n.textContent=t.validationMessage})),function(e){return Array.from(e.querySelectorAll(".popup__input")).every((function(e){return e.validity.valid}))}(e)?n.removeAttribute("disabled"):n.setAttribute("disabled",null)}var p,f=document.querySelector(".popup_type_image"),m=f.querySelector(".popup__image"),_=f.querySelector(".popup__caption");function h(e,t){m.setAttribute("src",e),m.setAttribute("alt",t),_.textContent=t,l(f)}var v,b=document.querySelector(".places__list");function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,i=o.querySelector(".places__item").cloneNode(!0),u=i.querySelector(".card__image");i.setAttribute("data-card-id",e._id),u.setAttribute("src",e.link),u.setAttribute("alt",e.name),u.addEventListener("click",(function(){return t(e.link,e.name)})),i.querySelector(".card__title").textContent=e.name;var s=i.querySelector(".card__delete-button");return s.addEventListener("click",r),e.owner._id!==v._id&&s.remove(),i.querySelector(".card__like_button").addEventListener("click",n),c(i),i}(e,h);b[t](n)}var S=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),k=document.querySelector(".profile__edit-button"),E=document.querySelector(".profile__image"),q=document.forms["edit-profile"],L=q.elements.name,A=q.elements.description;q.addEventListener("submit",(function(e){var t,o;e.preventDefault(),N(e.target),(t=L.value,o=A.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){v=e,B()})).then(u(j)).finally(H(e.target)).catch((function(e){console.log(e)}))}));var j=document.querySelector(".popup_type_edit");k.addEventListener("click",(function(){s,L.value=S.textContent,A.value=g.textContent,d(q),l(j)}));var C=document.querySelector(".profile__add-button"),x=document.forms["new-place"],P=x["place-name"],U=x.link,w=document.querySelector(".popup_type_new-card");C.addEventListener("click",(function(){d(x),l(w)})),x.addEventListener("submit",(function(e){e.preventDefault(),N(e.target);var t,o,r={name:P.value,link:U.value};e.target.reset(),(t=r.name,o=r.link,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){p[e._id]=e,u(w),y(e)})).finally(H(e.target)).catch((function(e){console.log(e)}))}));var T=document.querySelector(".popup_type_avatar"),O=document.querySelector(".profile__image"),D=document.forms["edit-avatar"];function B(){S.textContent=v.name,g.textContent=v.about,E.setAttribute("style","background-image: url('".concat(v.avatar,"')"))}function N(e){e.querySelector(".popup__button").textContent="Сохранение..."}function H(e){e.querySelector(".popup__button").textContent="Сохранить"}O.addEventListener("click",(function(){l(T)})),D.addEventListener("submit",(function(e){var t;e.preventDefault(),N(e.target),(t=e.target.elements.link.value,fetch("".concat(n.baseUrl,"/users/me/avatar/"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){v=e,B()})).then(u(T)).finally(H(e.target)).catch((function(e){console.log(e)}))})),window.addEventListener("load",(function(){j.classList.add("popup_is-animated"),w.classList.add("popup_is-animated"),f.classList.add("popup_is-animated")})),function(){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{formSelector,inputSelector,submitButtonSelector,inputErrorSelector};t=Object.assign(e),Array.from(document.querySelectorAll(t.inputSelector)).forEach((function(e){e.addEventListener("input",(function(e){d(e.target.closest(t.formSelector))}))}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorSelector:".popup__input_error"}),[f,w,j,T].forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&u(e),t.target.classList.contains("popup__close")&&u(e)}))}));var e=fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){p={},e.forEach((function(e){p[e._id]=Object.assign(e)}))})).catch((function(e){console.log(e)})),o=fetch("".concat(n.baseUrl,"/users/me "),{headers:n.headers}).then((function(e){return e.json()})).then((function(e){v=e,B()})).catch(console.log);Promise.all([e,o]).then((function(){return function(e){b.innerHTML="",e.forEach((function(e){return y(e,"append")}))}(Object.values(p))})).catch(console.log)}()})();